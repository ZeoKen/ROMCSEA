PlayerTipFuncConfig = {
  SendMessage = {
    name = ZhString.FunctionPlayerTip_SendMessage
  },
  InviteMember = {
    name = ZhString.FunctionPlayerTip_InviteMember
  },
  InviteGroup = {
    name = ZhString.FunctionPlayerTip_InviteGroup
  },
  AddFriend = {
    name = ZhString.FunctionPlayerTip_AddFriend
  },
  ShowDetail = {
    name = ZhString.FunctionPlayerTip_ShowDetail
  },
  SetLeader = {
    name = ZhString.FunctionPlayerTip_SetLeader
  },
  SetGroupLeader = {
    name = ZhString.FunctionPlayerTip_SetGroupLeader
  },
  KickMember = {
    name = ZhString.FunctionPlayerTip_KickMember,
    isCancelFunc = 1
  },
  LeaverTeam = {
    name = ZhString.FunctionPlayerTip_LeaverTeam,
    isCancelFunc = 1
  },
  FollowMember = {
    name = ZhString.FunctionPlayerTip_FollowMember
  },
  CancelFollowMember = {
    name = ZhString.FunctionPlayerTip_CancelFollowMember,
    isCancelFunc = 1
  },
  CreateTeam = {
    name = ZhString.FunctionPlayerTip_CreateTeam
  },
  JoinTeam = {
    name = ZhString.FunctionPlayerTip_JoinTeam
  },
  InviteFriend = {
    name = ZhString.FunctionPlayerTip_InviteFriend
  },
  InviteJoinHand = {
    name = ZhString.FunctionPlayerTip_InviteJoinHand
  },
  CancelJoinHand = {
    name = ZhString.FunctionPlayerTip_CancelJoinHand,
    isCancelFunc = 1
  },
  ApplyList = {
    name = ZhString.FunctionPlayerTip_ApplyList
  },
  GuildRecruit = {
    name = ZhString.FunctionPlayerTip_GuildRecruit
  },
  GiveGift = {
    name = ZhString.FunctionPlayerTip_GiveGift
  },
  DeleteFriend = {
    name = ZhString.FunctionPlayerTip_DeleteFriend,
    pushBackInArray = 1
  },
  ApplyEnterGuild = {
    name = ZhString.FunctionPlayerTip_ApplyEnterGuild
  },
  InviteEnterGuild = {
    name = ZhString.FunctionPlayerTip_InviteEnterGuild
  },
  VoteOut = {
    name = ZhString.FunctionPlayerTip_VoteOut
  },
  KickGuildMember = {
    name = ZhString.FunctionPlayerTip_KickGuildMember,
    isCancelFunc = 1
  },
  DistributeArtifact = {
    name = ZhString.FunctionPlayerTip_DistributeArtifact
  },
  ChangeGuildJob = {
    name = ZhString.FunctionPlayerTip_ChangeGuildJob
  },
  KickChatMember = {
    name = ZhString.FunctionPlayerTip_KickChatMember,
    isCancelFunc = 1
  },
  ExchangeRoomOwner = {
    name = ZhString.FunctionPlayerTip_ExchangeRoomOwner
  },
  AddBlacklist = {
    name = ZhString.FunctionPlayerTip_AddBlacklist,
    pushBackInArray = 1
  },
  ForeverBlacklist = {
    name = ZhString.FunctionPlayerTip_ForeverBlacklist,
    isCancelFunc = 1,
    pushBackInArray = 1
  },
  RemoveFromBlacklist = {
    name = ZhString.FunctionPlayerTip_RemoveFromBlacklist,
    isCancelFunc = 1,
    pushBackInArray = 1
  },
  RemoveFromForeverBlacklist = {
    name = ZhString.FunctionPlayerTip_RemoveFromBlacklist,
    isCancelFunc = 1,
    pushBackInArray = 1
  },
  FireHireman = {
    name = ZhString.FunctionPlayerTip_FireHireman
  },
  ReHireCat = {
    name = ZhString.FunctionPlayerTip_ReHireCat
  },
  ChangeCat = {
    name = ZhString.FunctionPlayerTip_ChangeCat
  },
  Pet_GiveGift = {
    name = ZhString.FunctionPlayerTip_Pet_GiveGift
  },
  Pet_Touch = {
    name = ZhString.FunctionPlayerTip_Pet_Touch
  },
  Pet_CallBack = {
    name = ZhString.FunctionPlayerTip_Pet_CallBack
  },
  Pet_ShowDetail = {
    name = ZhString.FunctionPlayerTip_Pet_ShowDetail
  },
  Pet_Hug = {
    name = ZhString.FunctionPlayerTip_Pet_Hug
  },
  Pet_CancelHug = {
    name = ZhString.FunctionPlayerTip_Pet_CancelHug,
    isCancelFunc = 1
  },
  Pet_AutoFight = {
    name = ZhString.FunctionPlayerTip_Pet_AutoFight
  },
  Tutor_InviteBeTutor = {
    name = ZhString.FunctionPlayerTip_Tutor_Tutor
  },
  Tutor_InviteBeStudent = {
    name = ZhString.FunctionPlayerTip_Tutor_Student
  },
  Tutor_DeleteTutor = {
    name = ZhString.FunctionPlayerTip_Tutor_DeleteTutor,
    isCancelFunc = 1
  },
  Tutor_DeleteStudent = {
    name = ZhString.FunctionPlayerTip_Tutor_DeleteTutor,
    isCancelFunc = 1
  },
  Wedding_MissYou = {
    name = ZhString.FunctionPlayerTip_WeddingMissYou
  },
  Wedding_CallBack = {
    name = ZhString.FunctionPlayerTip_WeddingCallBack
  },
  Double_Action = {
    name = ZhString.PlayerTip_DoubleAction,
    noCloseTip = 1
  },
  Booth = {
    name = ZhString.FunctionPlayerTip_Booth
  },
  FollowToRaid = {
    name = ZhString.FunctionPlayerTip_FollowToRaid
  },
  ChangeCat = {
    name = ZhString.FunctionPlayerTip_ChangeCat
  },
  ServantShop = {
    name = ZhString.FunctionPlayerTip_ServantShop
  },
  ServantHandIn = {
    name = ZhString.FunctionPlayerTip_ServantHandIn
  },
  ServantReset = {
    name = ZhString.FunctionPlayerTip_ServantReset
  },
  EnterHomeRoom = {
    name = ZhString.FunctionPlayerTip_EnterHomeRoom
  },
  Skada_Settings = {
    name = ZhString.FunctionPlayerTip_Skada_Settings
  },
  Skada_Analysis = {
    name = ZhString.FunctionPlayerTip_Skada_Analysis
  },
  Boki_Detail = {
    name = ZhString.FunctionPlayerTip_Boki_Detail
  },
  Boki_Follow = {
    name = ZhString.FunctionPlayerTip_Boki_Follow
  },
  Boki_CancelFollow = {
    name = ZhString.FunctionPlayerTip_Boki_CancelFollow,
    isCancelFunc = 1
  },
  Boki_ResetPos = {
    name = ZhString.FunctionPlayerTip_Boki_ResetPos
  },
  GME_VoiceShielding = {
    name = ZhString.FunctionPlayerTip_GME_VoiceShielding
  },
  GME_VoiceScreenDecoding = {
    name = ZhString.FunctionPlayerTip_GME_VoiceScreenDecoding
  },
  GME_ForbiddenWords = {
    name = ZhString.FunctionPlayerTip_GME_ForbiddenWords
  },
  GME_LiftingTheBan = {
    name = ZhString.FunctionPlayerTip_GME_LiftingTheBan,
    isCancelFunc = 1
  },
  GuildMercenaryInvite = {
    name = ZhString.FunctionPlayerTip_GuildMercenaryInvite
  },
  GuildMercenaryApply = {
    name = ZhString.FunctionPlayerTip_GuildMercenaryApply
  },
  GuildMercenaryKick = {
    name = ZhString.FunctionPlayerTip_GuildMercenaryKick,
    isCancelFunc = 1
  },
  ShowGUID = {
    name = ZhString.FunctionPlayerTip_ShowPlayerGUID
  },
  Pippi_Summon = {
    name = ZhString.FunctionPlayerTip_Pippi_Summon,
    isCancelFunc = 1
  },
  Pippi_Retire = {
    name = ZhString.FunctionPlayerTip_Pippi_Retire
  }
}
PlayerTipFuncState = {
  Active = 1,
  InActive = 2,
  Grey = 3,
  Special = 4,
  CrossZone = 5
}
local NewInviteTeammemberType = {Invite = 1, Apply = 2}
autoImport("RClickFuncCell")
autoImport("PlayerTip")
autoImport("PetTip")
autoImport("RClickTip")
autoImport("ChatRoomProxy")
autoImport("PlayerTipData")
autoImport("SocialIconCell")
FunctionPlayerTip = class("FunctionPlayerTip")
local friend = {}

function FunctionPlayerTip.Me()
  if nil == FunctionPlayerTip.me then
    FunctionPlayerTip.me = FunctionPlayerTip.new()
  end
  return FunctionPlayerTip.me
end

function FunctionPlayerTip:ctor()
  self.funcMap = {}
  self.checkMap = {}
  self.funcMap.SendMessage = FunctionPlayerTip.SendMessage
  self.funcMap.InviteMember = FunctionPlayerTip.InviteMember
  self.funcMap.InviteGroup = FunctionPlayerTip.InviteGroup
  self.funcMap.AddFriend = FunctionPlayerTip.AddFriend
  self.funcMap.ShowTeam = FunctionPlayerTip.ShowTeam
  self.funcMap.ShowDetail = FunctionPlayerTip.ShowDetail
  self.funcMap.SetLeader = FunctionPlayerTip.SetLeader
  self.funcMap.SetGroupLeader = FunctionPlayerTip.SetGroupLeader
  self.funcMap.KickMember = FunctionPlayerTip.KickMember
  self.funcMap.LeaverTeam = FunctionPlayerTip.LeaverTeam
  self.funcMap.FollowMember = FunctionPlayerTip.FollowMember
  self.funcMap.CancelFollowMember = FunctionPlayerTip.CancelFollowMember
  self.funcMap.CreateTeam = FunctionPlayerTip.CreateTeam
  self.funcMap.InviteFriend = FunctionPlayerTip.InviteFriend
  self.funcMap.InviteJoinHand = FunctionPlayerTip.InviteJoinHand
  self.funcMap.CancelJoinHand = FunctionPlayerTip.CancelJoinHand
  self.funcMap.ApplyList = FunctionPlayerTip.ApplyList
  self.funcMap.GuildRecruit = FunctionPlayerTip.GuildRecruit
  self.funcMap.GiveGift = FunctionPlayerTip.GiveGift
  self.funcMap.DeleteFriend = FunctionPlayerTip.DeleteFriend
  self.funcMap.ApplyEnterGuild = FunctionPlayerTip.ApplyEnterGuild
  self.funcMap.InviteEnterGuild = FunctionPlayerTip.InviteEnterGuild
  self.funcMap.VoteOut = FunctionPlayerTip.VoteOut
  self.funcMap.KickGuildMember = FunctionPlayerTip.KickGuildMember
  self.funcMap.DistributeArtifact = FunctionPlayerTip.DistributeArtifact
  self.funcMap.ChangeGuildJob = FunctionPlayerTip.ChangeGuildJob
  self.funcMap.KickChatMember = FunctionPlayerTip.KickChatMember
  self.funcMap.ExchangeRoomOwner = FunctionPlayerTip.ExchangeRoomOwner
  self.funcMap.AddBlacklist = FunctionPlayerTip.AddBlacklist
  self.funcMap.ForeverBlacklist = FunctionPlayerTip.ForeverBlacklist
  self.funcMap.RemoveFromBlacklist = FunctionPlayerTip.RemoveFromBlacklist
  self.funcMap.RemoveFromForeverBlacklist = FunctionPlayerTip.RemoveFromForeverBlacklist
  self.funcMap.FireHireman = FunctionPlayerTip.FireHireman
  self.funcMap.ReHireCat = FunctionPlayerTip.ReHireCat
  self.funcMap.Pet_GiveGift = FunctionPlayerTip.Pet_GiveGift
  self.funcMap.Pet_Touch = FunctionPlayerTip.Pet_Touch
  self.funcMap.Pet_CallBack = FunctionPlayerTip.Pet_CallBack
  self.funcMap.Pet_ShowDetail = FunctionPlayerTip.Pet_ShowDetail
  self.funcMap.Pet_Hug = FunctionPlayerTip.Pet_Hug
  self.funcMap.Pet_CancelHug = FunctionPlayerTip.Pet_CancelHug
  self.funcMap.Pet_AutoFight = FunctionPlayerTip.Pet_AutoFight
  self.funcMap.Tutor_InviteBeTutor = FunctionPlayerTip.Tutor_InviteBeTutor
  self.funcMap.Tutor_InviteBeStudent = FunctionPlayerTip.Tutor_InviteBeStudent
  self.funcMap.Tutor_DeleteTutor = FunctionPlayerTip.Tutor_DeleteTutor
  self.funcMap.Tutor_DeleteStudent = FunctionPlayerTip.Tutor_DeleteStudent
  self.funcMap.Wedding_MissYou = FunctionPlayerTip.Wedding_MissYou
  self.funcMap.Wedding_CallBack = FunctionPlayerTip.Wedding_CallBack
  self.funcMap.Double_Action = FunctionPlayerTip.Double_Action
  self.funcMap.Booth = FunctionPlayerTip.Booth
  self.funcMap.ChangeCat = FunctionPlayerTip.ChangeCat
  self.funcMap.ServantHandIn = FunctionPlayerTip.ServantHandIn
  self.funcMap.ServantReset = FunctionPlayerTip.ServantReset
  self.funcMap.ServantShop = FunctionPlayerTip.ServantShop
  self.funcMap.EnterHomeRoom = FunctionPlayerTip.EnterHomeRoom
  self.funcMap.Skada_Settings = FunctionPlayerTip.SkadaSettings
  self.funcMap.Skada_Analysis = FunctionPlayerTip.SkadaAnalysis
  self.funcMap.Boki_Detail = FunctionPlayerTip.Boki_Detail
  self.funcMap.Boki_Follow = FunctionPlayerTip.Boki_Follow
  self.funcMap.Boki_CancelFollow = FunctionPlayerTip.Boki_CancelFollow
  self.funcMap.Boki_ResetPos = FunctionPlayerTip.Boki_ResetPos
  self.funcMap.GME_VoiceShielding = FunctionPlayerTip.GMEVoiceShielding
  self.funcMap.GME_VoiceScreenDecoding = FunctionPlayerTip.GMEVoiceScreenDecoding
  self.funcMap.GME_ForbiddenWords = FunctionPlayerTip.GMEForbiddenWords
  self.funcMap.GME_LiftingTheBan = FunctionPlayerTip.GMELiftingTheBan
  self.funcMap.GuildMercenaryInvite = FunctionPlayerTip.GuildMercenaryInvite
  self.funcMap.GuildMercenaryApply = FunctionPlayerTip.GuildMercenaryApply
  self.funcMap.GuildMercenaryKick = FunctionPlayerTip.GuildMercenaryKick
  self.funcMap.ShowGUID = FunctionPlayerTip.ShowGUID
  self.funcMap.Pippi_Summon = FunctionPlayerTip.Pippi_Summon
  self.funcMap.Pippi_Retire = FunctionPlayerTip.Pippi_Retire
  self.checkMap.ServantHandIn = FunctionPlayerTip.CheckServantHandIn
  self.checkMap.ChangeGuildJob = FunctionPlayerTip.CheckChangeGuildJob
  self.checkMap.KickGuildMember = FunctionPlayerTip.CheckKickGuildMember
  self.checkMap.DistributeArtifact = FunctionPlayerTip.CheckDistributeArtifact
  self.checkMap.InviteEnterGuild = FunctionPlayerTip.CheckInviteEnterGuild
  self.checkMap.VoteOut = FunctionPlayerTip.CheckVoteOut
  self.checkMap.ApplyEnterGuild = FunctionPlayerTip.CheckApplyEnterGuild
  self.checkMap.InviteMember = FunctionPlayerTip.CheckInviteMember
  self.checkMap.InviteGroup = FunctionPlayerTip.CheckInviteGroup
  self.checkMap.ForeverBlacklist = FunctionPlayerTip.CheckForeverBlacklist
  self.checkMap.KickMember = FunctionPlayerTip.CheckKickMember
  self.checkMap.FireHireman = FunctionPlayerTip.CheckFireHireman
  self.checkMap.ReHireCat = FunctionPlayerTip.CheckReHireCat
  self.checkMap.Pet_Hug = FunctionPlayerTip.CheckPet_Hug
  self.checkMap.Pet_CancelHug = FunctionPlayerTip.CheckCancelPet_Hug
  self.checkMap.Pet_AutoFight = FunctionPlayerTip.CheckPet_AutoFight
  self.checkMap.Tutor_InviteBeTutor = FunctionPlayerTip.CheckTutor_InviteBeTutor
  self.checkMap.Tutor_InviteBeStudent = FunctionPlayerTip.CheckTutor_InviteBeStudent
  self.checkMap.Wedding_MissYou = FunctionPlayerTip.CheckWedding_MissYou
  self.checkMap.Wedding_CallBack = FunctionPlayerTip.CheckWedding_CallBack
  self.checkMap.Double_Action = FunctionPlayerTip.CheckDouble_Action
  self.checkMap.Booth = FunctionPlayerTip.CheckBooth
  self.checkMap.SetLeader = FunctionPlayerTip.CheckSetLeader
  self.checkMap.SetGroupLeader = FunctionPlayerTip.CheckSetGroupLeader
  self.checkMap.FollowMember = FunctionPlayerTip.CheckCrossZone
  self.checkMap.ChangeCat = FunctionPlayerTip.CheckChangeCat
  self.checkMap.EnterHomeRoom = FunctionPlayerTip.CheckEnterHomeRoom
  self.checkMap.Boki_Follow = FunctionPlayerTip.CheckBoki_Follow
  self.checkMap.Boki_CancelFollow = FunctionPlayerTip.CheckBoki_CancelFollow
  self.checkMap.Boki_ResetPos = FunctionPlayerTip.CheckBoki_ResetPos
  self.checkMap.GME_VoiceShielding = FunctionPlayerTip.CheckGMEVoiceShielding
  self.checkMap.GME_VoiceScreenDecoding = FunctionPlayerTip.CheckGMEVoiceScreenDecoding
  self.checkMap.GME_ForbiddenWords = FunctionPlayerTip.CheckGMEForbiddenWords
  self.checkMap.GME_LiftingTheBan = FunctionPlayerTip.CheckGMELiftingTheBan
  self.checkMap.GuildMercenaryInvite = FunctionPlayerTip.CheckGuildMercenaryInvite
  self.checkMap.GuildMercenaryApply = FunctionPlayerTip.CheckGuildMercenaryApply
  self.checkMap.GuildMercenaryKick = FunctionPlayerTip.CheckGuildMercenaryKick
  self.checkMap.Pippi_Summon = FunctionPlayerTip.CheckPippi_Summon
  self.checkMap.Pippi_Retire = FunctionPlayerTip.CheckPippi_Retire
end

function FunctionPlayerTip:GetPlayerFunckey(playerid)
  local result = {}
  result[3] = "SendMessage"
  result[4] = "AddFriend"
  if FunctionUnLockFunc.Me():CheckCanOpenByPanelId(PanelConfig.TeamMemberListPopUp.id) then
    result[1] = "InviteMember"
  end
  local showMercenaryBtn = true
  if TeamProxy.Instance:IHaveTeam() then
    local myTeam = TeamProxy.Instance.myTeam
    local teamMember = myTeam:GetMemberByGuid(playerid)
    local imleader = TeamProxy.Instance:CheckIHaveLeaderAuthority()
    if teamMember then
      local online = not teamMember:IsOffline()
      if not online then
        showMercenaryBtn = false
      end
      local isAfk = teamMember:IsAfk()
      if imleader then
        result[5] = "SetLeader"
        result[6] = "KickMember"
      end
      result[16] = "VoteOut"
      if online or isAfk then
        local attriFunction = Game.Myself.data:GetProperty("AttrFunction")
        local pos = CommonFun.AttrFunction.HandEnable or 1
        local serverCanJoinHand = attriFunction >> pos - 1 & 1 == 1
        local followId = Game.Myself:Client_GetFollowLeaderID()
        if followId == playerid then
          local isHandFollow = Game.Myself:Client_IsFollowHandInHand()
          if isHandFollow then
            result[2] = "FollowMember"
            if not isAfk then
              result[7] = "CancelJoinHand"
            end
          else
            result[2] = "CancelFollowMember"
            if serverCanJoinHand and not isAfk then
              local handFollowerId = Game.Myself:Client_GetHandInHandFollower()
              if handFollowerId == playerid then
                result[7] = "CancelJoinHand"
              else
                result[7] = "InviteJoinHand"
              end
            end
          end
        else
          local handFollowerId = Game.Myself:Client_GetHandInHandFollower()
          if handFollowerId == playerid then
            result[2] = "FollowMember"
            if not isAfk then
              result[7] = "CancelJoinHand"
            end
          else
            result[2] = "FollowMember"
            if serverCanJoinHand and not isAfk then
              result[7] = "InviteJoinHand"
            end
          end
        end
      end
    end
  end
  local hasGuild = GuildProxy.Instance:IHaveGuild()
  if hasGuild then
    result[9] = "InviteEnterGuild"
  else
    result[8] = "ApplyEnterGuild"
  end
  result[10] = "ShowDetail"
  result[11] = "Tutor_InviteBeStudent"
  result[12] = "Tutor_InviteBeTutor"
  result[13] = "AddBlacklist"
  result[14] = "DistributeArtifact"
  local uniteTeam = TeamProxy.Instance.uniteGroupTeam
  local uniteTeamMember = uniteTeam and uniteTeam:GetMemberByGuid(playerid)
  if uniteTeamMember then
    if uniteTeamMember:IsOffline() then
      showMercenaryBtn = false
    end
    if TeamProxy.Instance:CheckIHaveGroupLeaderAuthority() then
      result[6] = "KickMember"
      result[15] = "SetGroupLeader"
    end
  end
  if showMercenaryBtn then
    result[17] = "GuildMercenaryInvite"
    result[18] = "GuildMercenaryApply"
  end
  local resultlist = {}
  for i = 1, 18 do
    if result[i] then
      table.insert(resultlist, result[i])
    end
  end
  return resultlist
end

local funckeys = {}

function FunctionPlayerTip:GetHireCatFunckey(catTeamData)
  TableUtility.ArrayClear(funckeys)
  table.insert(funckeys, "ShowDetail")
  table.insert(funckeys, "KickMember")
  table.insert(funckeys, "FireHireman")
  table.insert(funckeys, "ReHireCat")
  table.insert(funckeys, "ChangeCat")
  if catTeamData.masterid ~= nil and catTeamData.masterid == Game.Myself.data.id then
    local attriFunction = Game.Myself.data:GetProperty("AttrFunction")
    local pos = CommonFun.AttrFunction.HandEnable or 1
    local serverCanJoinHand = attriFunction >> pos - 1 & 1 == 1
    if serverCanJoinHand then
      local handFollowerId = Game.Myself:Client_GetHandInHandFollower()
      if catTeamData.id == handFollowerId then
        table.insert(funckeys, 3, "CancelJoinHand")
      else
        table.insert(funckeys, 3, "InviteJoinHand")
      end
    end
  end
  return funckeys
end

function FunctionPlayerTip:GetPlayerTip(stick, side, offset, data)
  TipsView.Me():ShowStickTip(PlayerTip, data, side, stick, offset, "PlayerTip")
  return TipsView.Me().currentTip
end

function FunctionPlayerTip:GetPetTip(stick, side, offset, data)
  TipsView.Me():ShowStickTip(PetTip, data, side, stick, offset, "PetTip")
  return TipsView.Me().currentTip
end

function FunctionPlayerTip:CurPlayerTip()
  local playerTip = TipsView.Me().currentTip
  if playerTip and playerTip.__cname == "PlayerTip" then
    return playerTip
  end
end

function FunctionPlayerTip:CloseTip()
  if self:CurPlayerTip() then
    TipsView.Me():HideCurrent()
  end
end

function FunctionPlayerTip:CheckTipFuncStateByKey(key, playerTipData)
  if self.checkMap[key] then
    return self.checkMap[key](playerTipData)
  end
  return PlayerTipFuncState.Active
end

function FunctionPlayerTip:GetFuncByKey(key)
  return self.funcMap[key]
end

function FunctionPlayerTip.SendMessage(ptdata)
  if ptdata then
    local tempArray = ReusableTable.CreateArray()
    tempArray[1] = ptdata.id
    ServiceSessionSocialityProxy.Instance:CallAddRelation(tempArray, SocialManager.PbRelation.Chat)
    ReusableTable.DestroyArray(tempArray)
    GameFacade.Instance:sendNotification(UIEvent.JumpPanel, {
      view = PanelConfig.ChatRoomPage,
      viewdata = {
        key = "PrivateChat"
      }
    })
    GameFacade.Instance:sendNotification(ChatRoomEvent.UpdateSelectChat, ptdata)
  end
end

function FunctionPlayerTip.CallAddFriend(id, name)
  if FriendProxy.Instance:IsInBlacklist(id) then
    MsgManager.ConfirmMsgByID(427, function()
      TableUtility.ArrayClear(friend)
      table.insert(friend, id)
      FriendProxy.Instance:CallAddFriend(friend)
      MsgManager.ShowMsgByID(461, name)
    end, nil, nil, name)
  else
    TableUtility.ArrayClear(friend)
    table.insert(friend, id)
    FriendProxy.Instance:CallAddFriend(friend)
  end
end

function FunctionPlayerTip.AddFriend(ptdata)
  if ptdata then
    FunctionPlayerTip.CallAddFriend(ptdata.id, ptdata.name)
  end
end

function FunctionPlayerTip.DeleteFriend(ptdata)
  if ptdata ~= nil then
    MsgManager.ConfirmMsgByID(415, function()
      FunctionSecurity.Me():DeleteFriend(function(arg)
        ServiceSessionSocialityProxy.Instance:CallRemoveRelation(arg, SocialManager.PbRelation.Friend)
      end, ptdata.id)
    end, nil, nil, "Lv." .. ptdata.level .. " " .. ptdata.name)
  end
end

function FunctionPlayerTip.ShowDetail(ptdata)
  if ptdata.cat and ptdata.cat ~= 0 then
    if FunctionUnLockFunc.Me():CheckCanOpen(10001) then
      GameFacade.Instance:sendNotification(UIEvent.JumpPanel, {
        view = PanelConfig.MercenaryCatView,
        viewdata = {
          CatID = ptdata.cat
        }
      })
    else
      local data = {
        staticData = Table_MercenaryCat[ptdata.cat],
        expiretime = ptdata.expiretime,
        masterid = ptdata.masterid
      }
      TipManager.Instance:ShowCatTip(data, nil, nil, {-100, 0})
    end
  elseif ptdata.id then
    ServiceChatCmdProxy.Instance:CallQueryUserInfoChatCmd(ptdata.id, nil, ChatCmd_pb.EUSERINFOTYPE_CHAT)
  end
end

function FunctionPlayerTip.InviteMember(ptdata)
  FunctionTeamInvite.Me():InviteMember(ptdata.invitee)
end

function FunctionPlayerTip.InviteGroup(ptdata)
  FunctionTeamInvite.Me():InviteGroup(ptdata.invitee)
end

function FunctionPlayerTip.SetLeader(ptdata)
  if PvpProxy.Instance:Is12PvpInMatch() then
    MsgManager.ShowMsgByID(25984)
    return
  end
  if ptdata.id then
    MsgManager.ConfirmMsgByID(327, function()
      ServiceSessionTeamProxy.Instance:CallExchangeLeader(ptdata.id)
    end, nil, nil, ptdata.name)
  end
end

function FunctionPlayerTip.SetGroupLeader(ptdata)
  if PvpProxy.Instance:Is12PvpInMatch() then
    MsgManager.ShowMsgByID(25984)
    return
  end
  if ptdata.id then
    MsgManager.ConfirmMsgByID(25945, function()
      ServiceSessionTeamProxy.Instance:CallChangeGroupLeaderTeamCmd(ptdata.id)
    end, nil, nil, ptdata.name)
  end
end

function FunctionPlayerTip.KickMember(ptdata)
  if TeamProxy.Instance:IsVoteKickOpen() then
    MsgManager.ShowMsgByID(39106)
    return
  end
  if ptdata.id then
    MsgManager.ConfirmMsgByID(326, function()
      if ptdata.cat ~= nil and ptdata.cat ~= 0 then
        ServiceSessionTeamProxy.Instance:CallKickMember(ptdata.id, ptdata.cat)
      elseif ptdata.robot ~= nil and ptdata.robot ~= 0 then
        ServiceSessionTeamProxy.Instance:CallKickMember(ptdata.id, nil, nil, ptdata.id)
      else
        if PvpProxy.Instance:IsInPreparation() then
          MsgManager.ShowMsgByID(39102)
          return
        end
        ServiceSessionTeamProxy.Instance:CallKickMember(ptdata.id)
      end
    end, nil, nil, ptdata.name)
  end
end

function FunctionPlayerTip.LeaverTeam(ptdata)
  if PvpProxy.Instance:IsInPreparation() then
    MsgManager.ShowMsgByID(39102)
    return
  end
  if PvpProxy.Instance:Is12PvpInMatch() then
    MsgManager.ShowMsgByID(25984)
    return
  end
  if TeamProxy.Instance:IHaveTeam() then
    if Game.MapManager:IsPVPMode_MvpFight() then
      MsgManager.ConfirmMsgByID(7312, function()
        if TeamProxy.Instance:IHaveTeam() then
          ServiceSessionTeamProxy.Instance:CallExitTeam(TeamProxy.Instance.myTeam.id)
        end
      end, nil, nil)
      return
    end
    if Game.MapManager:IsPVPMode_TeamPws() then
      MsgManager.ConfirmMsgByID(25910, function()
        if TeamProxy.Instance:IHaveTeam() then
          ServiceSessionTeamProxy.Instance:CallExitTeam(TeamProxy.Instance.myTeam.id)
        end
      end, nil, nil)
      return
    end
    local sysMsg = 328
    local raidReward = MyselfProxy.Instance:getVarValueByType(Var_pb.EVARTYPE_HAS_USERRETURN_RAID_AWARD) or 0
    if 0 < raidReward then
      sysMsg = 42085
    end
    MsgManager.ConfirmMsgByID(sysMsg, function()
      if TeamProxy.Instance:IHaveTeam() then
        ServiceSessionTeamProxy.Instance:CallExitTeam(TeamProxy.Instance.myTeam.id)
      end
    end, nil, nil, TeamProxy.Instance.myTeam.name)
  end
end

function FunctionPlayerTip.ShowMyDetail(ptdata)
  GameFacade.Instance:sendNotification(UIEvent.JumpPanel, {
    view = PanelConfig.Charactor
  })
end

function FunctionPlayerTip.FollowMember(ptdata)
  if not ptdata or not ptdata.id then
    return
  end
  GameFacade.Instance:sendNotification(FollowEvent.Follow, ptdata.id)
end

function FunctionPlayerTip.CancelFollowMember(ptdata)
  if ptdata then
    Game.Myself:Client_SetFollowLeader(0)
  end
end

function FunctionPlayerTip.CreateTeam(ptdata)
  if not TeamProxy.Instance:IHaveTeam() then
    local defaultMinlv = 1
    local defaultGoal = GameConfig.Team.defaulttype or 10010
    local defaultAuto = GameConfig.Team.defaultauto or 2
    local defaultState = SessionTeam_pb.ETEAMSTATE_FREE or 0
    local defaultMaxlv = GameConfig.Team.filtratelevel[#GameConfig.Team.filtratelevel]
    local defaultname = string.format(OverSea.LangManager.Instance():GetLangByKey(ZhString.Pvp_DesertWolfJoinName), Game.Myself.data:GetName())
    ServiceSessionTeamProxy.Instance:CallCreateTeam(defaultMinlv, defaultMaxlv, defaultGoal, defaultAuto, defaultname, defaultState)
  end
end

function FunctionPlayerTip.ApplyList(ptdata)
  GameFacade.Instance:sendNotification(UIEvent.JumpPanel, {
    view = PanelConfig.TeamApplyListPopUp
  })
end

function FunctionPlayerTip.InviteFriend(ptdata)
  GameFacade.Instance:sendNotification(UIEvent.JumpPanel, {
    view = PanelConfig.TeamInvitePopUp
  })
end

function FunctionPlayerTip.InviteJoinHand(ptdata)
  if Game.Myself:IsInBooth() then
    MsgManager.ShowMsgByID(25712)
    return
  end
  local haveTeam = TeamProxy.Instance:IHaveTeam()
  local myTeamData = TeamProxy.Instance.myTeam
  local tmData = myTeamData and myTeamData:GetMemberByGuid(ptdata.id)
  if ptdata.masterid ~= nil then
    if ptdata.masterid ~= nil and ptdata.masterid == Game.Myself.data.id then
      local myTeamData = TeamProxy.Instance.myTeam
      if myTeamData then
        local catTeamData = myTeamData:GetMemberByGuid(ptdata.id)
        if catTeamData then
          if Game.Myself:IsDead() then
            MsgManager.ShowMsgByIDTable(5005)
            return
          end
          local expiretime = catTeamData.expiretime
          if expiretime ~= 0 and expiretime < ServerTime.CurServerTime() / 1000 then
            MsgManager.ShowMsgByIDTable(5005)
            return
          end
          local resttime = catTeamData.resttime
          if resttime ~= 0 and resttime >= ServerTime.CurServerTime() / 1000 then
            MsgManager.ShowMsgByIDTable(5005)
            return
          end
        end
      end
    end
    ServiceUserEventProxy.Instance:CallHandCatUserEvent(ptdata.id, false)
  elseif haveTeam and tmData then
    if tmData.hp and 0 >= tmData.hp then
      MsgManager.ShowMsgByIDTable(856)
      return
    end
    local role = NSceneUserProxy.Instance:Find(ptdata.id)
    if role then
      local isTransformed = role.data:IsTransformed()
      if isTransformed then
        MsgManager.ShowMsgByIDTable(830)
        return
      end
      local buffeffect = role.data:GetBuffEffectByType(BuffType.PartTransform)
      if buffeffect ~= nil and buffeffect.NoHandInHand == 1 then
        MsgManager.ShowMsgByIDTable(830)
        return
      end
    end
    ServiceNUserProxy.Instance:CallInviteJoinHandsUserCmd(ptdata.id)
  else
    MsgManager.ShowMsgByIDTable(827)
  end
end

function FunctionPlayerTip.CancelJoinHand(ptdata)
  MsgManager.ConfirmMsgByID(826, function()
    if ptdata.masterid ~= nil and ptdata.masterid == Game.Myself.data.id then
      ServiceUserEventProxy.Instance:CallHandCatUserEvent(ptdata.id, true)
    else
      ServiceNUserProxy.Instance:CallBreakUpHandsUserCmd()
    end
  end, nil, nil)
end

function FunctionPlayerTip.ShowTeam(ptdata)
  GameFacade.Instance:sendNotification(UIEvent.JumpPanel, {
    view = PanelConfig.TeamMemberListPopUp
  })
end

function FunctionPlayerTip.ChangeGuildJob(ptdata)
  if GvgProxy.Instance:CheckInSettleTime() and GuildProxy.Instance:CanJobDoAuthority(ptdata.parama.job, GuildAuthorityMap.GvgCity) then
    MsgManager.ShowMsgByID(2682)
    return
  end
  local myGuildMemberData = GuildProxy.Instance:GetMyGuildMemberData()
  if myGuildMemberData then
    local canDo = GuildProxy.Instance:CanJobDoAuthority(myGuildMemberData.job, GuildAuthorityMap.SetJob)
    if canDo then
      local viewdata = {
        view = PanelConfig.GuildJobChangePopUp,
        viewdata = {
          guildMember = ptdata.parama
        }
      }
      GameFacade.Instance:sendNotification(UIEvent.JumpPanel, viewdata)
    end
  end
end

function FunctionPlayerTip.KickGuildMember(ptdata)
  local member = ptdata.parama
  if member then
    MsgManager.ConfirmMsgByID(2800, function()
      ServiceGuildCmdProxy.Instance:CallKickMemberGuildCmd(member.id)
    end, nil, self, member.baselevel, member.name)
  end
end

function FunctionPlayerTip.DistributeArtifact(ptdata)
  if not ptdata or not ptdata.id then
    return
  end
  local artiData = ArtifactProxy.Instance:GetOptionalArtifacts(ptdata.id)
  if artiData and 0 < #artiData then
    GameFacade.Instance:sendNotification(UIEvent.JumpPanel, {
      view = PanelConfig.ArtifactDistributePopUp,
      viewdata = {
        data = artiData,
        charID = ptdata.id
      }
    })
  else
    MsgManager.ShowMsgByID(3806)
  end
end

function FunctionPlayerTip.ApplyEnterGuild(ptdata)
  if GuildProxy.Instance:IsInJoinCD() then
    MsgManager.ShowMsgByIDTable(4046)
    return
  end
  if ptdata and ptdata.guildid then
    ServiceGuildCmdProxy.Instance:CallApplyGuildGuildCmd(ptdata.guildid)
  end
end

function FunctionPlayerTip.InviteEnterGuild(ptdata)
  if ptdata then
    local role = NSceneUserProxy.Instance:Find(ptdata.id)
    if role then
      local guildData = role.data:GetGuildData()
      if guildData and guildData.id and guildData.id > 0 then
        MsgManager.ShowMsgByID(31045)
        return
      end
    end
    ServiceGuildCmdProxy.Instance:CallInviteMemberGuildCmd(ptdata.id)
  end
end

function FunctionPlayerTip.VoteOut(ptdata)
  if not ptdata then
    return
  end
  local VOTE_CD = 1
  local MIN_VOTE_NUM = GameConfig.Team.min_vote_kick_num or 3
  local totalNum = 0
  local myTeam, myMembers = TeamProxy.Instance.myTeam
  if myTeam then
    myMembers = myTeam:GetPlayerMemberList(true, true)
    for k, v in pairs(myMembers) do
      if not v:IsOffline() then
        totalNum = totalNum + 1
      end
    end
  end
  if MIN_VOTE_NUM > totalNum then
    MsgManager.ShowMsgByID(387)
    return
  end
  local curServerTime = ServerTime.CurServerTime() / 1000
  if FunctionPlayerTip.votecd and VOTE_CD > curServerTime - FunctionPlayerTip.votecd then
    MsgManager.ShowMsgByID(386)
    return
  else
    FunctionPlayerTip.votecd = curServerTime
  end
  ServiceSessionTeamProxy:CallLaunckKickTeamCmd(Game.Myself.data.id, ptdata.id)
end

function FunctionPlayerTip.KickChatMember(ptdata)
  if ptdata then
    if not ChatZoomProxy.Instance:SomeoneIsInZoom(ptdata.id) then
      MsgManager.ShowMsgByID(809)
    else
      local zoomInfo = ChatZoomProxy.Instance:CachedZoomInfo()
      ServiceChatRoomProxy.Instance:CallKickChatMember(zoomInfo.roomid, ptdata.id)
    end
  end
end

function FunctionPlayerTip.ExchangeRoomOwner(ptdata)
  if ptdata then
    if not ChatZoomProxy.Instance:SomeoneIsInZoom(ptdata.id) then
      MsgManager.ShowMsgByID(809)
    else
      ServiceChatRoomProxy.Instance:CallExchangeRoomOwner(ptdata.id)
    end
  end
end

function FunctionPlayerTip.AddBlacklist(ptdata)
  if ptdata and ptdata.id then
    if FriendProxy.Instance:IsBlacklist(ptdata.id) then
      MsgManager.ShowMsgByID(464)
    else
      local name = ptdata.name or ""
      MsgManager.ConfirmMsgByID(425, function()
        local tempArray = ReusableTable.CreateArray()
        tempArray[1] = ptdata.id
        ServiceSessionSocialityProxy.Instance:CallAddRelation(tempArray, SocialManager.PbRelation.Black)
        ReusableTable.DestroyArray(tempArray)
      end, nil, nil, name)
    end
  end
end

function FunctionPlayerTip.ForeverBlacklist(ptdata)
  if ptdata and ptdata.id then
    local name = ptdata.name or ""
    MsgManager.ConfirmMsgByID(426, function()
      local tempArray = ReusableTable.CreateArray()
      tempArray[1] = ptdata.id
      ServiceSessionSocialityProxy.Instance:CallAddRelation(tempArray, SocialManager.PbRelation.BlackForever)
      ReusableTable.DestroyArray(tempArray)
    end, nil, nil, name)
  end
end

function FunctionPlayerTip.RemoveFromBlacklist(ptdata)
  if ptdata and ptdata.id then
    local name = ptdata.name or ""
    ServiceSessionSocialityProxy.Instance:CallRemoveRelation(ptdata.id, SocialManager.PbRelation.Black)
    MsgManager.ShowMsgByID(461, name)
  end
end

function FunctionPlayerTip.RemoveFromForeverBlacklist(ptdata)
  if ptdata and ptdata.id then
    local name = ptdata.name or ""
    ServiceSessionSocialityProxy.Instance:CallRemoveRelation(ptdata.id, SocialManager.PbRelation.BlackForever)
    MsgManager.ShowMsgByID(461, name)
  end
end

function FunctionPlayerTip.FireHireman(ptdata)
  if ptdata.cat then
    MsgManager.ConfirmMsgByID(5002, function()
      ServiceScenePetProxy.Instance:CallFireCatPetCmd(ptdata.cat)
    end, nil, nil)
  end
end

function FunctionPlayerTip.ReHireCat(ptdata)
  if ptdata.cat then
    GameFacade.Instance:sendNotification(UIEvent.ShowUI, {
      viewname = "HireCatPopUp",
      catid = ptdata.cat
    })
  end
end

function FunctionPlayerTip.Pet_GiveGift(ptdata)
  local myPetInfo = PetProxy.Instance:GetMyPetInfoData(ptdata.petid)
  if Table_PetCompose[myPetInfo.petid] then
    local data = {petinfoData = myPetInfo}
    TipManager.Instance:ShowFeedPetTip(data)
    return
  end
  local giftItems = myPetInfo:GetGiftItems()
  local _, itemid = next(giftItems)
  local item = BagProxy.Instance:GetItemByStaticID(itemid)
  if item and item.num > 0 then
    local dont = LocalSaveProxy.Instance:GetDontShowAgain(9015)
    if dont == nil then
      MsgManager.DontAgainConfirmMsgByID(9015, function()
        ServiceScenePetProxy.Instance:CallGiveGiftPetCmd(myPetInfo.petid, item.id)
      end, nil, nil, item.staticData.NameZh, myPetInfo.name)
    else
      ServiceScenePetProxy.Instance:CallGiveGiftPetCmd(myPetInfo.petid, item.id)
    end
  else
    local list = ReusableTable.CreateArray()
    list[1] = {id = itemid, count = 1}
    QuickBuyProxy.Instance:TryOpenView(list)
    ReusableTable.DestroyArray(list)
  end
end

function FunctionPlayerTip.Pet_Touch(ptdata)
  local petData = Table_Pet[ptdata.petid]
  local skillID
  if petData ~= nil and petData.TouchSkill ~= nil then
    local race = MyselfProxy.Instance:GetMyRace()
    skillID = petData.TouchSkill[race]
  end
  skillID = skillID or 10000
  local target = PetProxy.Instance:GetMySceneNpet(ptdata.petid)
  if target then
    Game.Myself:Client_UseSkill(skillID, target)
  end
end

function FunctionPlayerTip.Pet_CallBack(ptdata)
  if ptdata.beingid then
    ServiceSceneBeingProxy.Instance:CallBeingOffCmd(ptdata.beingid)
  elseif ptdata.petid then
    if BagProxy.Instance:CheckPetBagIsFull() then
      MsgManager.ShowMsgByID(43465)
      return
    end
    MsgManager.ConfirmMsgByID(9005, function()
      ServiceScenePetProxy.Instance:CallEggRestorePetCmd(ptdata.petid)
    end, nil, nil)
  else
    helplog("Pet_CallBack Not Find id.")
  end
end

function FunctionPlayerTip.Pet_ShowDetail(ptdata)
  if Game.InteractNpcManager:IsMyselfOnNpc() then
    MsgManager.ShowMsgByIDTable(832)
    return
  end
  if ptdata.petid then
    local scenePet = PetProxy.Instance:GetMySceneNpet(ptdata.petid)
    if scenePet == nil then
      MsgManager.ShowMsgByIDTable(9007)
      return
    end
    local petInfoData = PetProxy.Instance:GetMyPetInfoData(ptdata.petid)
    GameFacade.Instance:sendNotification(UIEvent.JumpPanel, {
      view = PanelConfig.PetInfoView,
      viewdata = {petInfoData = petInfoData}
    })
  elseif ptdata.beingid then
    local sceneBeing = PetProxy.Instance:GetSceneBeingNpc(ptdata.beingid)
    if sceneBeing == nil then
      MsgManager.ShowMsgByIDTable(9007)
      return
    end
    local beingInfoData = PetProxy.Instance:GetMyBeingNpcInfo(ptdata.beingid)
    GameFacade.Instance:sendNotification(UIEvent.JumpPanel, {
      view = PanelConfig.BeingInfoView,
      viewdata = {beingInfoData = beingInfoData}
    })
  end
end

function FunctionPlayerTip.Pet_Hug(ptdata)
  if Game.Myself.data:IsTransformed() then
    MsgManager.ShowMsgByIDTable(830)
    return
  end
  local handNpc = Game.Myself:GetHandNpc()
  if handNpc then
    MsgManager.ShowMsgByIDTable(856)
    return
  end
  local petInfoData = PetProxy.Instance:GetMyPetInfoData(ptdata.petid)
  if petInfoData:CanHug() then
    ServiceScenePetProxy.Instance:CallHandPetPetCmd(petInfoData.guid, false)
    EventManager.Me():PassEvent(PetEvent.SendHug, {
      id = petInfoData.guid,
      isHug = true
    })
  end
end

function FunctionPlayerTip.Pet_CancelHug(ptdata)
  local petInfoData = PetProxy.Instance:GetMyPetInfoData(ptdata.petid)
  ServiceScenePetProxy.Instance:CallHandPetPetCmd(petInfoData.guid, true)
  EventManager.Me():PassEvent(PetEvent.SendHug, {
    id = petInfoData.guid,
    isHug = false
  })
end

function FunctionPlayerTip.Pet_AutoFight(ptdata)
  if ptdata.petid then
    local myPetInfo = PetProxy.Instance:GetMyPetInfoData(ptdata.petid)
    if myPetInfo then
      ServiceScenePetProxy.Instance:CallSwitchSkillPetCmd(ptdata.petid, not myPetInfo:IsAutoFighting())
    end
  elseif ptdata.beingid then
    local beingInfo = PetProxy.Instance:GetMyBeingNpcInfo(ptdata.beingid)
    if beingInfo then
      ServiceSceneBeingProxy.Instance:CallBeingSwitchState(ptdata.beingid, not beingInfo:IsAutoFighting())
    end
  end
end

function FunctionPlayerTip.Tutor_InviteBeTutor(ptdata)
  helplog("Tutor_InviteBeTutor:", ptdata.id)
  TutorProxy.Instance:CallAddStudent(ptdata.id)
end

function FunctionPlayerTip.Tutor_InviteBeStudent(ptdata)
  helplog("Tutor_InviteBeStudent:", ptdata.id)
  TutorProxy.Instance:CallAddTutor(ptdata.id)
end

function FunctionPlayerTip.Tutor_DeleteTutor(ptdata)
  TutorProxy.Instance:CallDeleteTutor(ptdata.id)
end

function FunctionPlayerTip.Tutor_DeleteStudent(ptdata)
  TutorProxy.Instance:CallDeleteStudent(ptdata.id)
end

function FunctionPlayerTip.Wedding_MissYou(ptdata)
  helplog("Call Missyou InviteWedCCmd")
  ServiceWeddingCCmdProxy.Instance:CallMissyouInviteWedCCmd()
end

function FunctionPlayerTip.Wedding_CallBack(ptdata)
  local skillId = GameConfig.Wedding.BackSkill_Id or 13001
  Game.Myself:Client_UseSkill(skillId)
end

function FunctionPlayerTip.Double_Action(ptdata)
  local downID = Game.Myself.data:GetDownID()
  if downID and downID ~= 0 then
    MsgManager.ShowMsgByID(43538)
    return
  end
  local tip = FunctionPlayerTip.Me():CurPlayerTip()
  if tip then
    tip:ShowChildBord()
  else
    LogUtility.Warning("Cannot get current player tip. Double-action message will be ignored.")
  end
end

function FunctionPlayerTip.Booth(ptdata)
  BoothProxy.Instance:SafeJumpBoothMainView(ptdata.id)
end

function FunctionPlayerTip.ChangeCat(ptdata)
  local viewdata = {
    view = PanelConfig.ChangeCatPopUp,
    viewdata = {
      originalID = ptdata.cat,
      catData = TeamProxy.Instance:GetCanChangeCats()
    }
  }
  GameFacade.Instance:sendNotification(UIEvent.JumpPanel, viewdata)
end

function FunctionPlayerTip.Boki_Detail(ptdata)
  BokiProxy.Instance:OpenBokiView()
end

function FunctionPlayerTip.Boki_Follow(ptdata)
  if Game.Myself:IsDead() then
    MsgManager.ShowMsgByIDTable(41246)
    return
  end
  ServiceNUserProxy.Instance:CallSetBoKiStateUserCmd(BokiProxy.EFollow.EActive)
end

function FunctionPlayerTip.Boki_CancelFollow(ptdata)
  if Game.Myself:IsDead() then
    MsgManager.ShowMsgByIDTable(41246)
    return
  end
  ServiceNUserProxy.Instance:CallSetBoKiStateUserCmd(BokiProxy.EFollow.EInActive)
end

function FunctionPlayerTip.Boki_ResetPos(ptdata)
  if Game.Myself:IsDead() then
    MsgManager.ShowMsgByIDTable(41427)
    return
  end
  local boki = BokiProxy.Instance:GetSceneBoki()
  if boki and boki:IsDead() then
    MsgManager.ShowMsgByIDTable(41427)
    return
  end
  local curTime = ServerTime.CurServerTime()
  if FunctionPlayerTip.nextBokiResetTime and curTime < FunctionPlayerTip.nextBokiResetTime then
    MsgManager.ShowMsgByIDTable(41423)
    return
  end
  local curRoomID = RaidPuzzleManager.Me():GetCurrentRoomID()
  local cd = RaidPuzzleManager.Me():GetRaidConfig("OutlastCD")
  if not cd or cd <= 0 or not curRoomID then
    MsgManager.ShowMsgByIDTable(41425)
    return
  end
  local forbidResetRooms = RaidPuzzleManager.Me():GetRaidConfig("ForbidBokiResetRoom")
  if forbidResetRooms and 0 < TableUtility.ArrayFindIndex(forbidResetRooms, curRoomID) then
    MsgManager.ShowMsgByIDTable(41424)
    return
  end
  FunctionPlayerTip.nextBokiResetTime = curTime + cd * 1000
  ServiceRaidCmdProxy.Instance:CallRaidPuzzlePosRaidCmd()
end

function FunctionPlayerTip.TalkAuthorization(ptdata)
  if FunctionPlayerTip.Me():GetWhereIClickThisIcon() == PlayerTipSource.FromTeam then
  else
  end
end

function FunctionPlayerTip.EnterHomeRoom(ptdata)
  redlog("enter room", ptdata.homeid, ptdata.accid, ptdata.id)
  if ptdata.homeid then
    ServiceHomeCmdProxy.Instance:CallEnterHomeCmd(ptdata.accid, ptdata.id)
  end
end

function FunctionPlayerTip.CheckIHasGuildAuthority(aid)
  local canDo = false
  local myGuildMemberData = GuildProxy.Instance:GetMyGuildMemberData()
  if myGuildMemberData then
    canDo = GuildProxy.Instance:CanJobDoAuthority(myGuildMemberData.job, aid)
  end
  if canDo then
    return PlayerTipFuncState.Active
  else
    return PlayerTipFuncState.InActive
  end
end

function FunctionPlayerTip.CheckChangeGuildJob(data)
  if data.id ~= Game.Myself.data.id and not GuildProxy.Instance:IsPlayerMyGuildMember(data.id) then
    return PlayerTipFuncState.InActive
  end
  return FunctionPlayerTip.CheckIHasGuildAuthority(GuildAuthorityMap.SetJob)
end

function FunctionPlayerTip.CheckKickGuildMember(data)
  if data.id ~= Game.Myself.data.id and not GuildProxy.Instance:IsPlayerMyGuildMember(data.id) then
    return PlayerTipFuncState.InActive
  end
  if data.id == Game.Myself.data.id or GuildProxy.Instance:IsChairmanOfMyGuild(data.id) then
    return PlayerTipFuncState.InActive
  end
  return FunctionPlayerTip.CheckIHasGuildAuthority(GuildAuthorityMap.KickMember)
end

function FunctionPlayerTip.CheckDistributeArtifact(data)
  if GameConfig.SystemForbid.GvGDroiyan or Table_FuncState[4] and not FunctionUnLockFunc.checkFuncStateValid(4) then
    return PlayerTipFuncState.InActive
  end
  local myGuildData = GuildProxy.Instance.myGuildData
  if myGuildData then
    local guildMemberData = myGuildData:GetMemberByGuid(data.id)
    if not guildMemberData or guildMemberData:IsMercenary() then
      return PlayerTipFuncState.InActive
    end
    local switch = ArtifactProxy.Instance:GetDistributeActiveFlag()
    if guildMemberData and switch then
      return FunctionPlayerTip.CheckIHasGuildAuthority(GuildAuthorityMap.ArtifactOption)
    end
  end
  return PlayerTipFuncState.InActive
end

function FunctionPlayerTip.CheckInviteEnterGuild(data)
  if MyselfProxy.Instance:IsSameServer(data.serverid) then
    return FunctionPlayerTip.CheckIHasGuildAuthority(GuildAuthorityMap.InviteJoin)
  else
    return PlayerTipFuncState.InActive
  end
end

function FunctionPlayerTip.CheckVoteOut(data)
  if data.id == Game.Myself.data.id then
    return PlayerTipFuncState.InActive
  end
  local myTeam = TeamProxy.Instance.myTeam
  if myTeam then
    if myTeam:IsVoteKickOpen() then
      return PlayerTipFuncState.Active
    else
      return PlayerTipFuncState.InActive
    end
  end
  return PlayerTipFuncState.InActive
end

function FunctionPlayerTip.CheckApplyEnterGuild(data)
  if not MyselfProxy.Instance:IsSameServer(data.serverid) then
    return PlayerTipFuncState.InActive
  end
  if GuildProxy.Instance:IHaveGuild() then
    return PlayerTipFuncState.InActive
  end
  local canDo = false
  if data then
    canDo = data.guildid ~= nil and data.guildid ~= 0
  end
  if canDo then
    return PlayerTipFuncState.Active
  else
    return PlayerTipFuncState.InActive
  end
end

function FunctionPlayerTip.CheckInviteMember(data)
  ServiceSessionTeamProxy.Instance:CallQueryUserTeamInfoTeamCmd(data.id)
  return PlayerTipFuncState.Active
end

function FunctionPlayerTip.CheckInviteGroup(data)
  if TeamProxy.Instance:IHaveGroup() or TeamProxy.Instance:IsInMyGroup(data.id) then
    return PlayerTipFuncState.InActive
  end
  ServiceSessionTeamProxy.Instance:CallQueryUserTeamInfoTeamCmd(data.id)
  return PlayerTipFuncState.Active
end

function FunctionPlayerTip.CheckForeverBlacklist(data)
  return PlayerTipFuncState.Special
end

function FunctionPlayerTip.CheckKickMember(data)
  if Game.MapManager:IsPVPMode_TeamPws() then
    return PlayerTipFuncState.InActive
  end
  if Game.MapManager:IsPVEMode_ExpRaid() then
    return PlayerTipFuncState.InActive
  end
  if data.cat and data.masterid == Game.Myself.data.id then
    return PlayerTipFuncState.Active
  end
  if TeamProxy.Instance:CheckIHaveGroupLeaderAuthority() then
    return PlayerTipFuncState.Active
  end
  if TeamProxy.Instance:CheckIHaveLeaderAuthority() and TeamProxy.Instance:IsInMyTeam(data.id) then
    return PlayerTipFuncState.Active
  end
  return PlayerTipFuncState.InActive
end

function FunctionPlayerTip.CheckFireHireman(data)
  if data.masterid ~= nil and data.masterid == Game.Myself.data.id then
    local myTeamData = TeamProxy.Instance.myTeam
    if myTeamData then
      local catTeamData = myTeamData:GetMemberByGuid(data.id)
      if catTeamData then
        return PlayerTipFuncState.Active
      end
    end
  end
  return PlayerTipFuncState.InActive
end

function FunctionPlayerTip.CheckReHireCat(data)
  if data.masterid ~= nil and data.masterid == Game.Myself.data.id then
    return PlayerTipFuncState.Active
  end
  return PlayerTipFuncState.InActive
end

function FunctionPlayerTip.CheckPet_Hug(data)
  if Game.InteractNpcManager:IsMyselfOnNpc() then
    return PlayerTipFuncState.InActive
  end
  local petInfoData = PetProxy.Instance:GetMyPetInfoData(data.petid)
  if petInfoData:CanHug() then
    local scenePet = PetProxy.Instance:GetMySceneNpet(petid)
    local otherName
    if scenePet and scenePet.data:GetFeature_BeHold() then
      otherName = ZhString.FunctionPlayerTip_Pet_Hug
    else
      otherName = ZhString.FunctionPlayerTip_Pet_HandInHand
    end
    return PlayerTipFuncState.Active, otherName
  end
  return PlayerTipFuncState.InActive
end

function FunctionPlayerTip.CheckCancelPet_Hug(data)
  local petInfoData = PetProxy.Instance:GetMyPetInfoData(data.petid)
  local otherName
  if petInfoData then
    local scenePet = PetProxy.Instance:GetMySceneNpet(petid)
    if scenePet and scenePet.data:GetFeature_BeHold() then
      otherName = ZhString.FunctionPlayerTip_Pet_CancelHug
    else
      otherName = ZhString.FunctionPlayerTip_Pet_CancelHandInHand
    end
  end
  return PlayerTipFuncState.Active, otherName, true
end

function FunctionPlayerTip.CheckTutor_InviteBeTutor(ptdata)
  if GameConfig.SystemForbid.Tutor then
    return PlayerTipFuncState.InActive
  end
  local mytutor = TutorProxy.Instance:GetMyTutor()
  if mytutor ~= nil then
    return PlayerTipFuncState.InActive
  end
  if TutorProxy.Instance:CanAsStudent() then
    return PlayerTipFuncState.Active
  end
  return PlayerTipFuncState.InActive
end

function FunctionPlayerTip.CheckTutor_InviteBeStudent(ptdata)
  if GameConfig.SystemForbid.Tutor then
    return PlayerTipFuncState.InActive
  end
  if TutorProxy.Instance:CanAsTutor() then
    return PlayerTipFuncState.Active
  end
  return PlayerTipFuncState.InActive
end

function FunctionPlayerTip.CheckPet_AutoFight(ptdata)
  if ptdata == nil then
    return PlayerTipFuncState.InActive
  end
  local myPetInfo
  if ptdata.petid then
    myPetInfo = PetProxy.Instance:GetMyPetInfoData(ptdata.petid)
  elseif ptdata.beingid then
    myPetInfo = PetProxy.Instance:GetMyBeingNpcInfo(ptdata.beingid)
  end
  if myPetInfo == nil then
    return PlayerTipFuncState.InActive
  end
  if myPetInfo:IsAutoFighting() then
    return PlayerTipFuncState.Active, ZhString.FunctionPlayerTip_Pet_CancelAutoFight, true
  else
    return PlayerTipFuncState.Active, ZhString.FunctionPlayerTip_Pet_AutoFight
  end
end

function FunctionPlayerTip.CheckWedding_MissYou(ptdata)
  if WeddingProxy.Instance:IsSelfMarried() then
    return PlayerTipFuncState.Active
  end
  return PlayerTipFuncState.InActive
end

function FunctionPlayerTip.CheckWedding_CallBack(ptdata)
  return PlayerTipFuncState.InActive
end

function FunctionPlayerTip.CheckDouble_Action(ptdata)
  if GameConfig.SystemForbid.DoubleAction then
    return PlayerTipFuncState.InActive
  end
  local _TeamProxy = TeamProxy.Instance
  if _TeamProxy:CheckIsCatByPlayerId(ptdata.id) then
    return PlayerTipFuncState.InActive
  end
  return PlayerTipFuncState.Active
end

function FunctionPlayerTip.CheckBooth(ptdata)
  local player = NSceneUserProxy.Instance:Find(ptdata.id)
  if player ~= nil and player:IsInBooth() then
    return PlayerTipFuncState.Active
  end
  return PlayerTipFuncState.InActive
end

function FunctionPlayerTip.CheckSetLeader(ptdata)
  if Game.MapManager:IsPVPMode_TeamPws() or Game.MapManager:IsPvPMode_TeamTwelve() then
    return PlayerTipFuncState.InActive
  end
  return PlayerTipFuncState.Active
end

function FunctionPlayerTip.CheckSetGroupLeader(ptdata)
  if not (not Game.MapManager:IsPVPMode_TeamPws() and TeamProxy.Instance:CheckIHaveGroupLeaderAuthority()) or Game.MapManager:IsPvPMode_TeamTwelve() then
    return PlayerTipFuncState.InActive
  end
  if TeamProxy.Instance:IsInMyTeam(ptdata.id) or not TeamProxy.Instance:IsInMyGroup(ptdata.id) then
    return PlayerTipFuncState.InActive
  end
  return PlayerTipFuncState.Active
end

function FunctionPlayerTip.CheckCrossZone(ptdata)
  if not ptdata or not ptdata.id then
    return PlayerTipFuncState.Active
  end
  if Game.Myself:IsDead() then
    return PlayerTipFuncState.Active
  end
  local myTeam = TeamProxy.Instance.myTeam
  if myTeam == nil then
    return PlayerTipFuncState.Active
  end
  local teamMemberData = myTeam:GetMemberByGuid(ptdata.id)
  local curImageId = ServicePlayerProxy.Instance:GetCurMapImageId() or 0
  local memberInRaid = teamMemberData.raid ~= 0 or Table_MapRaid[teamMemberData.mapid] ~= nil
  local myRaid = Game.MapManager:GetRaidID() ~= 0 and Game.MapManager:GetRaidID() or curImageId
  local meInRaid = Game.MapManager:IsRaidMode() and Game.MapManager:GetMapID() ~= 10001 or 0 < curImageId
  if memberInRaid and not meInRaid then
    return PlayerTipFuncState.CrossZone, ZhString.FunctionPlayerTip_FollowToRaid
  end
  if not (ptdata.zoneid ~= MyselfProxy.Instance:GetZoneId() or memberInRaid or meInRaid) or ptdata.zoneid == MyselfProxy.Instance:GetZoneId() and teamMemberData.raid == myRaid then
    return PlayerTipFuncState.Active
  else
    if memberInRaid then
      if Game.MapManager:IsHomeMap(teamMemberData.raid) then
        return PlayerTipFuncState.InActive
      elseif not meInRaid then
        return PlayerTipFuncState.CrossZone, ZhString.FunctionPlayerTip_FollowToRaid
      end
    end
    return PlayerTipFuncState.Active
  end
end

function FunctionPlayerTip.ServantShop(ptdata)
  local servantID = Game.Myself.data.userdata:Get(UDEnum.SERVANTID)
  local shopcfg = Table_Npc[servantID] and Table_Npc[servantID].NpcFunction and Table_Npc[servantID].NpcFunction[1]
  if not shopcfg then
    redlog("未找到执事商店配置 请检查npc表,错误ID: ", servantID)
    return
  end
  local myServantNpc = NScenePetProxy.Instance:Find(ptdata.id)
  HappyShopProxy.Instance:InitShop(myServantNpc, shopcfg.param, shopcfg.type)
  FunctionNpcFunc.JumpPanel(PanelConfig.HappyShop, {npcdata = myServantNpc})
end

function FunctionPlayerTip.ServantHandIn(ptdata)
  local handFollowerId = Game.Myself:Client_GetHandInHandFollower()
  if nil == handFollowerId or handFollowerId ~= ptdata.id then
    ServiceNUserProxy.Instance:CallServantService(SceneUser2_pb.ESERVANT_SERVICE_INVITE_HAND)
  else
    ServiceNUserProxy.Instance:CallServantService(SceneUser2_pb.ESERVANT_SERVICE_BREAK_HAND)
  end
end

function FunctionPlayerTip.ServantReset(ptdata)
  ServiceNUserProxy.Instance:CallShowServantUserCmd(false)
end

function FunctionPlayerTip.CheckChangeCat(ptdata)
  local cats = TeamProxy.Instance:GetCanChangeCats()
  if nil ~= ptdata.masterid and ptdata.masterid == Game.Myself.data.id and 0 < #cats then
    return PlayerTipFuncState.Active
  else
    return PlayerTipFuncState.InActive
  end
end

function FunctionPlayerTip.CheckTalkAuthorization(ptdata)
  local myGuildData = GuildProxy.Instance.myGuildData
  local guildMemberData
  if myGuildData then
    guildMemberData = myGuildData:GetMemberByGuid(ptdata.id)
  end
  local othrerName = "impossible"
  if guildMemberData and guildMemberData:IsRealtimevoice() then
    othrerName = ZhString.DISABLE_MIC
  else
    othrerName = ZhString.ENABLE_MIC
  end
  local state = PlayerTipFuncState.Active
  if GuildProxy.Instance:CanIDoAuthority(GuildAuthorityMap.Voice) then
    state = PlayerTipFuncState.Active
    if GameConfig.realtime_voice_limit and GVoiceProxy.Instance:GetCurGuildRealTimeVoiceCount() < GameConfig.realtime_voice_limit then
      state = PlayerTipFuncState.Active
    else
      state = PlayerTipFuncState.InActive
    end
  else
    state = PlayerTipFuncState.InActive
  end
  state = PlayerTipFuncState.Active
  if FunctionPlayerTip.Me():GetWhereIClickThisIcon() == PlayerTipSource.FromTeam then
    if TeamProxy.Instance:CheckImTheLeader() == false then
      state = PlayerTipFuncState.InActive
    else
      local myTeam = TeamProxy.Instance.myTeam
      if myTeam then
        local myMembers = myTeam:GetMembersList()
        for i = 1, #myMembers do
          local memberData = myMembers[i]
          if memberData.id == ptdata.id then
            if memberData:GetRealTimeVoice() == 1 then
              othrerName = ZhString.DISABLE_MIC
            elseif memberData:GetRealTimeVoice() == 0 then
              othrerName = ZhString.ENABLE_MIC
            end
          end
        end
      end
    end
  end
  return state, othrerName
end

function FunctionPlayerTip:HandleQueryUserTeamInfo(server_data)
  local player_id = server_data and server_data.charid
  if not player_id then
    return false
  end
  local curTip = self:CurPlayerTip()
  if not curTip then
    return false
  end
  local playerTipData = curTip.playerTipData
  if not playerTipData then
    return false
  end
  if playerTipData.id ~= player_id then
    return false
  end
  playerTipData:SetQueryTeamInfo(server_data)
  curTip:HandleQueryUserTeamCmd()
  return true
end

function FunctionPlayerTip:SetWhereIClickThisIcon(where)
  self.whereClick = where
end

function FunctionPlayerTip:GetWhereIClickThisIcon()
  return self.whereClick or PlayerTipSource.FromTeam
end

local _MultiSpriteKey = {
  EnterHomeRoom = 30,
  FollowMember = 50,
  CancelFollowMember = 52,
  Pet_GiveGift = 60,
  Pet_Touch = 70,
  Pet_Hug = 80,
  Pet_CancelHug = 82,
  Pet_CallBack = 90,
  InviteGroup = 110
}

function FunctionPlayerTip:CheckTipSocialStateByKey(key, playertipdata)
  local socialState = 0
  local playerid = playertipdata.id
  if key == "AddFriend" then
    if not FriendProxy.Instance:IsFriend(playerid) then
      socialState = 10
    else
      socialState = 11
    end
  elseif key == "InviteMember" then
    if not TeamProxy.Instance:IsInMyGroup(playerid) then
      socialState = 40
    else
      socialState = 41
    end
  else
    local state = _MultiSpriteKey[key]
    if state then
      socialState = state
    end
  end
  return socialState
end

function FunctionPlayerTip.CheckServantHandIn(ptdata)
  local myServantID = Game.Myself.data.userdata:Get(UDEnum.SERVANTID)
  if not myServantID or myServantID == 0 then
    return PlayerTipFuncState.InActive
  end
  local handFollowerId = Game.Myself:Client_GetHandInHandFollower()
  if nil == handFollowerId or handFollowerId ~= ptdata.id then
    return PlayerTipFuncState.Active, ZhString.FunctionPlayerTip_ServantHandIn
  else
    return PlayerTipFuncState.Active, ZhString.FunctionPlayerTip_CancelServantHandIn, true
  end
end

function FunctionPlayerTip.CheckEnterHomeRoom(ptdata)
  if Game.MapManager:IsPVPMode() or Game.MapManager:IsPveMode_Thanatos() then
    return PlayerTipFuncState.InActive
  end
  if ptdata.homeid and ptdata.homeid ~= 0 then
    return PlayerTipFuncState.Active
  end
  return PlayerTipFuncState.InActive
end

function FunctionPlayerTip.CheckBoki_Follow(ptdata)
  if BokiProxy.EFollow.EInActive == BokiProxy.Instance:GetFollowState() then
    return PlayerTipFuncState.Active
  end
  return PlayerTipFuncState.InActive
end

function FunctionPlayerTip.CheckBoki_CancelFollow(ptdata)
  if BokiProxy.EFollow.EActive == BokiProxy.Instance:GetFollowState() then
    return PlayerTipFuncState.Active
  end
  return PlayerTipFuncState.InActive
end

function FunctionPlayerTip.CheckBoki_ResetPos(ptdata)
  if RaidPuzzleManager.Me():IsWorking() then
    return PlayerTipFuncState.Active
  end
  return PlayerTipFuncState.InActive
end

function FunctionPlayerTip.SkadaSettings(data)
  GameFacade.Instance:sendNotification(UIEvent.JumpPanel, {
    view = PanelConfig.SkadaSettingView,
    viewdata = data.id
  })
end

function FunctionPlayerTip.SkadaAnalysis(data)
  GameFacade.Instance:sendNotification(UIEvent.JumpPanel, {
    view = PanelConfig.SkadaRecordView,
    viewdata = data.id
  })
end

local funckeys = {}

function FunctionPlayerTip:GetRobotFunckey(memberData)
  TableUtility.ArrayClear(funckeys)
  table.insert(funckeys, "KickMember")
  return funckeys
end

function FunctionPlayerTip.GMEVoiceShielding(data)
  GmeVoiceProxy.Instance:addToMyselfBanList(data.id)
end

function FunctionPlayerTip.GMEVoiceScreenDecoding(data)
  for _, v in pairs(TeamProxy.Instance.myTeam:GetMembersList()) do
    if v.id == data.id and v.mute ~= 0 then
      redlog("被队长禁言中无法自己解除屏蔽")
      return
    end
  end
  GmeVoiceProxy.Instance:removeMyselfBanList(data.id)
end

function FunctionPlayerTip.GMEForbiddenWords(data)
  ServiceSessionTeamProxy.Instance:CallGMEMuteTeamCmd(data.id, true)
end

function FunctionPlayerTip.GMELiftingTheBan(data)
  ServiceSessionTeamProxy:CallGMEMuteTeamCmd(data.id, false)
end

function FunctionPlayerTip.CheckGMEVoiceShielding(data)
end

function FunctionPlayerTip.CheckGMEVoiceScreenDecoding(data)
end

function FunctionPlayerTip.CheckGMEForbiddenWords(data)
end

function FunctionPlayerTip.CheckGMELiftingTheBan(data)
end

function FunctionPlayerTip.GuildMercenaryInvite(data)
  if data then
    ServiceGuildCmdProxy.Instance:CallInviteMemberGuildCmd(data.id, nil, nil, nil, GuildCmd_pb.EGUILDJOB_INVITE_MERCENARY)
  end
end

function FunctionPlayerTip.GuildMercenaryApply(data)
  if not data.guildid or data.guildid == 0 then
    MsgManager.ShowMsgByID(31072)
    return
  end
  ServiceGuildCmdProxy.Instance:CallApplyGuildGuildCmd(data.guildid, GuildCmd_pb.EGUILDJOB_APPLY_MERCENARY)
end

function FunctionPlayerTip.GuildMercenaryKick(data)
  local member = data.parama
  if member then
    MsgManager.ConfirmMsgByID(31038, function()
      ServiceGuildCmdProxy.Instance:CallKickMemberGuildCmd(member.id)
    end, nil, self, member.baselevel, member.name)
  end
end

function FunctionPlayerTip.CheckGuildMercenaryInvite(data)
  if not MyselfProxy.Instance:IsSameServer(data.serverid) then
    return PlayerTipFuncState.InActive
  end
  local myGuildMemberData = GuildProxy.Instance:GetMyGuildMemberData()
  if not myGuildMemberData then
    return PlayerTipFuncState.InActive
  end
  if not GuildProxy.Instance:CanJobDoAuthority(myGuildMemberData.job, GuildAuthorityMap.InviteJoin) then
    return PlayerTipFuncState.InActive
  end
  return PlayerTipFuncState.Active
end

function FunctionPlayerTip.CheckGuildMercenaryApply(data)
  local guildProxy = GuildProxy.Instance
  if not MyselfProxy.Instance:IsSameServer(data.serverid) then
    return PlayerTipFuncState.InActive
  end
  if guildProxy:GetMyMercenaryGuildData() then
    return PlayerTipFuncState.InActive
  end
  if not data.guildid or data.guildid == 0 then
    return PlayerTipFuncState.InActive
  end
  local myGuildMemberData = guildProxy:GetMyGuildMemberData()
  if myGuildMemberData and not guildProxy:CanJobDoAuthority(myGuildMemberData.job, GuildAuthorityMap.CanBeMercenary) then
    return PlayerTipFuncState.InActive
  end
  return PlayerTipFuncState.Active
end

function FunctionPlayerTip.CheckGuildMercenaryKick(data)
  if data.id == Game.Myself.data.id then
    return PlayerTipFuncState.InActive
  end
  local proxy = GuildProxy.Instance
  if not proxy:IsPlayerMyGuildMercenary(data.id) then
    return PlayerTipFuncState.InActive
  end
  local myGuildMemberData = proxy:GetMyGuildMemberData()
  if not myGuildMemberData then
    return PlayerTipFuncState.InActive
  end
  if not proxy:CanJobDoAuthority(myGuildMemberData.job, GuildAuthorityMap.PermitJoin) then
    return PlayerTipFuncState.InActive
  end
  return PlayerTipFuncState.Active
end

function FunctionPlayerTip.ShowGUID(ptdata)
  TipManager.Instance:SetPlayerGuidTip(ptdata, nil, nil)
end

function FunctionPlayerTip.Pippi_Summon(ptdata)
  ServiceMessCCmdProxy.Instance:CallSetPippiStateMessCCmd(true)
end

function FunctionPlayerTip.Pippi_Retire(ptdata)
  ServiceMessCCmdProxy.Instance:CallSetPippiStateMessCCmd(false)
end

function FunctionPlayerTip.CheckPippi_Summon(ptdata)
  local pState, ptime = PetProxy.Instance:GetMyPippiInfoData()
  if pState == EPIPPISTATE.EPIPPISTATE_LIVE_SHOW or pState == EPIPPISTATE.EPIPPISTATE_DIE_SHOW then
    return PlayerTipFuncState.InActive
  else
    return PlayerTipFuncState.Active
  end
end

function FunctionPlayerTip.CheckPippi_Retire(ptdata)
  local pState, ptime = PetProxy.Instance:GetMyPippiInfoData()
  if pState == EPIPPISTATE.EPIPPISTATE_LIVE_HIDE or pState == EPIPPISTATE.EPIPPISTATE_DIE_HIDE then
    return PlayerTipFuncState.InActive
  else
    return PlayerTipFuncState.Active
  end
end
